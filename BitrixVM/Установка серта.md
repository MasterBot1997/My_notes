
---

- https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=37&CHAPTER_ID=029364&LESSON_PATH=3908.29228.29358.29364

---

Выбираем в менюшке `Manage pool web servers`

Далее `Configure certificates`, Затем вибараем то что нам надо:
```
There are 2 sites:
------------------------------------------------------------------------------------
SiteName        | dbName          |       Type | S | Certificate          | Key
------------------------------------------------------------------------------------
bitrix.horrorbot.ru | animeb4b_bx1    |     kernel | N | ssl/cert.pem         | ssl/cert.pem
default         | sitemanager     |     kernel | N | ssl/cert.pem         | ssl/cert.pem
------------------------------------------------------------------------------------
Note:
S - Only HTTPS access to the server (N = turned off, Y = turned on)

Found push-configuration:
------------------------------------------------------------------------------------
SiteName        | Certificate                    | Key
------------------------------------------------------------------------------------
push-server     | /etc/nginx/ssl/cert.pem        | /etc/nginx/ssl/cert.pem
------------------------------------------------------------------------------------
Available actions:

        1. Configure "Let's encrypt" certificate
        2. Configure own certificate
        3. Restore default certificate
        0. Go to previous screen or exit
```

- 1. Configure "Let's encrypt" certificate - выпуск серта LE

	**Важно! Прежде, чем выпускать сертификат Let’s Encrypt, убедитесь, что у вас [создан сайт](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=37&LESSON_ID=29320) на тот хост (и он доступен из интернета), на который выпускается сертификат, а также указаны правильные DNS-настройки у регистратора или хостера DNS для этого домена. Иначе он не будет выпущен. Плюс к этому есть лимит – 5 ошибок в час выпуска сертификата на аккаунт для одного домена.**

	- Перейти в меню 8. Manage pool web servers > 2. Configure certificates.
	- Выбрать пункт меню 1. Configure "Let's encrypt" certificate и ввести:
	    - **Enter site name** – имя сайта или несколько имен сайтов, для которых нужно выпустить сертификат(ы) Let's encrypt (в данном примере: **example.org**)
	    - **Enter Domain(s)** – все домены данного сайта, для которых должен быть выпущен сертификат, включая домен с www и без, вводить несколько доменов через запятую
	    - **Enter email for "Let's encrypt" notifications** – почтовый адрес для уведомлений сервиса Let's Encrypt

	**Ручное обновление**

	В версии _BitrixVM_ 9.0.0 проверка сертификатов автоматически производится еженедельно в субботу в 2 часа ночи по cron-у.
	
	Если вам нужно вручную обновить сертификат, запустите его получение для существующего домена. Система проверит и при необходимости обновит сертификаты.
	
	Также вы можете вручную командой:
	
	```undefined
	/home/bitrix/dehydrated/dehydrated -c
	```
	
	Система проверит сроки действия и при необходимости запустит обновление.
	
	Лог обновления можно посмотреть по пути: **/home/bitrix/dehydrated_update.log**.

	**Важно!** У сервиса Lets Encrypt есть свои ограничения на выпуск сертификатов. Основные из них:
	- Выпуск 50 штук в неделю на домены (на зарегистрированные домены у регистратора, поддомены не входят в этот счет).
	- Если у вас много поддоменов, то можно все поддомены указать в одном сертификате, но здесь есть лимит в 100 поддоменов на одну штуку.
	- 5 ошибок в час выпуска сертификата на аккаунт для одного домена (не доступен хост, не прописаны записи в DNS домена и т.д).
	- Проверка HTTP-01 выполняется только с использованием порта 80. Если этот порт закрыт (провайдером, например), то [сертификат не перевыпустится](https://letsencrypt.org/ru/docs/challenge-types/ "Документация Lets Encrypt").
	
	Подробнее о лимитах Let’s Encrypt читайте в статье [Rate Limits](https://letsencrypt.org/docs/rate-limits/).

- 2. Configure own certificate - установка собственного серта
	У вас должны быть следующие файлы: **приватный ключ (private key)**, **цепочка сертификатов (certificate chain)** и **сам сертификат (certificate)**.

	**Требования к импортируемым сертификатам:**
	
	- Все перечисленные файлы должны быть в **PEM-кодировке**.
	- Приватный ключ не должен быть зашифрован.
	- Обязательны файлы сертификата и приватного ключа, файл с цепочкой можно не указывать.
	- Если вы используете свои пути для загрузки, то нужно указывать при импорте полные пути. Если хотите использовать относительные пути, то файлы сертификатов должны быть загружены в директорию **/etc/nginx/certs**.

	Для подключения своего SSL-сертификата нужно:

	- Скопировать файлы сертификата в любую директорию на сервере с помощью любого клиента SFTP. В нашем примере мы создали директорию **/home/bitrix/ssl/** и скопировали файлы в неё.
    
    Пути получились такие:
    
    1. **приватный ключ** – `/home/bitrix/ssl/example.org_privkey.pem`
    2. **сам сертификат** – `/home/bitrix/ssl/example.org_cert.pem`
    3. **цепочка сертификатов** – `/home/bitrix/ssl/example.org_chain.pem`
    
	- Далее перейти в меню 7. Manage pool web servers > 2. Configure certificates.
	- Выбрать пункт меню 2. Configure own certificate и ввести **имя домена** (Sitename) или несколько доменов, для которых нужно импортировать сертификат(ы) (в данном примере: **example.org**), **путь для приватного ключа (Private Key path)**, **путь для сертификата (Certificate path)**, **путь для цепочки сертификатов (Certificate Chain path)** и подтвердить установку для этого домена.

	**Поддерживается ввод нескольких сайтов, через запятую. Следить за сроком действия своего сертификата вы должны сами. Перевыпуск осуществляется также владельцем сайта. После перевыпуска нового сертификата нужно будет заново его импортировать.**

- 3. Restore default certificate - восстановление серта по умолчанию
	Если что-то пошло не так или вы хотите восстановить самоподписанный сертификат, который создается при первом запуске _BitrixVM_, то для этого нужно:

	- Перейти в меню 7. Manage pool web servers > 2. Configure certificates.
	- Выбрать пункт меню 3. Restore default certificate и ввести **certificate file path** — путь к сертификату, который указан в таблице с сайтами в поле **Certificate** и подтвердить действие